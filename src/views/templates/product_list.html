<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список товаров - Онлайн-магазин</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header>
        <h1>Товары</h1>
        <nav>
            <ul>
                <li><a href="/">Главная</a></li>
                <li><a href="/products">Товары</a></li>
                <li><a href="/cart">Корзина</a></li>
                <li><a href="/orders">Заказы</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <div class="container">
            <h2>Каталог товаров</h2>
            
            <!-- Поиск товаров -->
            <div class="search-box">
                <form action="/products/search" method="GET">
                    <input type="text" name="q" placeholder="Поиск товаров..." value="{{ keyword or '' }}">
                    <button type="submit">Найти</button>
                </form>
            </div>
            
            <!-- Список товаров -->
            <div class="products-grid">
                {% if products %}
                    {% for product in products %}
                    <div class="product-card">
                        {% if product.image_url %}
                        <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-image">
                        {% else %}
                        <div class="product-image-placeholder">No image</div>
                        {% endif %}
                        
                        <div class="product-info">
                            <h3 class="product-name">{{ product.name }}</h3>
                            <p class="product-description">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
                            <div class="product-details">
                                <span class="product-price">{{ helpers.format_price(product.price, 'RUB') }}</span>
                                <span class="product-category">{{ product.category }}</span>
                                <span class="product-stock {% if product.stock > 0 %}in-stock{% else %}out-of-stock{% endif %}">
                                    {{ product.stock }} в наличии
                                </span>
                            </div>
                            
                            <div class="product-actions">
                                <a href="/products/{{ product.id }}" class="btn btn-info">Подробнее</a>
                                
                                {% if product.stock > 0 %}
                                <form action="/cart/items" method="POST" style="display: inline;">
                                    <input type="hidden" name="product_id" value="{{ product.id }}">
                                    <input type="hidden" name="quantity" value="1">
                                    <button type="submit" class="btn btn-primary">В корзину</button>
                                </form>
                                {% else %}
                                <button class="btn btn-disabled" disabled>Нет в наличии</button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-products">
                        <p>Товары не найдены</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- Пагинация -->
            {% if pagination %}
            <div class="pagination">
                {% if pagination.has_prev %}
                <a href="?page={{ pagination.page - 1 }}">&laquo; Назад</a>
                {% endif %}
                
                <span class="current-page">Страница {{ pagination.page }} из {{ pagination.total_pages }}</span>
                
                {% if pagination.has_next %}
                <a href="?page={{ pagination.page + 1 }}">Вперед &raquo;</a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </main>
    
    <footer>
        <p>© 2024 Онлайн-магазин. Все права защищены.</p>
    </footer>
</body>
</html>